{"version":3,"file":"subscribeScript.js","sources":["subscribeScript.js"],"sourcesContent":["setTimeout(async () => {\r\n  let today = new Date().toISOString().split('T')[0];\r\n  let storageKey = 'disabled-element-created';\r\n  let url = 'https://anettaschool.ru/user/my/profile';\r\n  let storedData = localStorage.getItem(storageKey);\r\n  if (storedData !== today) {\r\n    try {\r\n      let response = await fetch(url);\r\n      let html = await response.text();\r\n      let doc = new DOMParser().parseFromString(html, 'text/html');\r\n      let selectElement = doc.getElementById('User_subscribe_status');\r\n      let selectedValue = selectElement.options[selectElement.selectedIndex].value;\r\n      if (selectedValue !== 'all') {\r\n        let userId = await getUserId(doc);\r\n        let message = `\r\n          <div class=\"alert-message\">\r\n            <span class=\"alert-message-close\">+</span>\r\n            <p class=\"alert-message-title\">Важное напоминание!</p>\r\n            <p class=\"alert-message-text\">Вы отписаны от рассылок и пропускаете важные уведомления и новости.</p>\r\n            <a href=\"${url}\" class=\"alert-message-link\">Подписаться</a>\r\n          </div>\r\n        `;\r\n        document.body.insertAdjacentHTML('afterbegin', message);\r\n        document.querySelector('.alert-message-close').addEventListener('click', async () => {\r\n          document.querySelector('.alert-message').remove();\r\n          await sendDataToSheets('close', today, userId);\r\n        });\r\n        document.querySelector('.alert-message-link').addEventListener('click', async (e) => {\r\n          e.preventDefault();\r\n          document.querySelector('.alert-message').remove();\r\n          await sendDataToSheets('click', today, userId);\r\n          window.location.href = url;\r\n        });\r\n        localStorage.setItem(storageKey, today);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Ошибка:\", error);\r\n    }\r\n  }\r\n  async function getUserId(doc) {\r\n    let elemId = doc.querySelector(\".page-header .btn-link\").getAttribute(\"onclick\");\r\n    let regex = /\\/pl\\/(\\d+)/;\r\n    let match = elemId.match(regex);\r\n    return match[1];\r\n  }\r\n  async function sendDataToSheets(action, date, userId) {\r\n    let urlScript = \"https://script.google.com/macros/s/AKfycbymKd-ooXw3hjPO7TV8Hfjunq33dOMqFnsUwnwNDguzCrBbA6jsuwN6ikfhruNuStUbOg/exec\";\r\n    try {\r\n      let response = await fetch(urlScript + `?userId=${userId}&date=${date}&action=${action}`, { mode: \"cors\" });\r\n      let data = await response.json();\r\n      console.log(data);\r\n    } catch (error) {\r\n      console.error(\"Ошибка:\", error);\r\n    }\r\n  }\r\n}, 10000);"],"names":["setTimeout","async","let","today","Date","toISOString","split","storageKey","url","localStorage","getItem","html","await","fetch","text","doc","DOMParser","parseFromString","selectElement","getElementById","options","selectedIndex","value","userId","match","elemId","querySelector","getAttribute","document","body","insertAdjacentHTML","addEventListener","remove","sendDataToSheets","e","preventDefault","window","location","href","setItem","error","console","action","date","data","mode","json","log"],"mappings":"AAAAA,WAAWC,UACTC,IAAIC,GAAQ,IAAIC,MAAOC,YAAY,EAAEC,MAAM,GAAG,EAAE,GAChDJ,IAAIK,EAAa,2BACjBL,IAAIM,EAAM,0CAEV,GADiBC,aAAaC,QAAQH,CAAU,IAC7BJ,EACjB,IACED,IACIS,EAAOC,MADIA,MAAMC,MAAML,CAAG,GACJM,KAAK,EAC3BC,GAAM,IAAIC,WAAYC,gBAAgBN,EAAM,WAAW,EACvDO,EAAgBH,EAAII,eAAe,uBAAuB,EAE9D,GAAsB,QADFD,EAAcE,QAAQF,EAAcG,eAAeC,MAC1C,CAC3BpB,IAAIqB,EAASX,MA0BnBX,MAAyBc,IAGnBS,GAFAC,EAASV,EAAIW,cAAc,wBAAwB,EAAEC,aAAa,SAAS,GAE5DH,MADP,aACkB,GACjB,IA9BoBT,CAAG,EAMjBP,EAGfoB,SAASC,KAAKC,mBAAmB,aARnB,8ZAQwC,EACtDF,SAASF,cAAc,sBAAsB,EAAEK,iBAAiB,QAAS9B,UACvE2B,SAASF,cAAc,gBAAgB,EAAEM,OAAO,EAChDpB,MAAMqB,EAAiB,QAAS9B,EAAOoB,CAAM,CAC/C,CAAC,EACDK,SAASF,cAAc,qBAAqB,EAAEK,iBAAiB,QAAS9B,MAAOiC,IAC7EA,EAAEC,eAAe,EACjBP,SAASF,cAAc,gBAAgB,EAAEM,OAAO,EAChDpB,MAAMqB,EAAiB,QAAS9B,EAAOoB,CAAM,EAC7Ca,OAAOC,SAASC,KAAO9B,CACzB,CAAC,EACDC,aAAa8B,QAAQhC,EAAYJ,CAAK,CACxC,CAGF,CAFE,MAAOqC,GACPC,QAAQD,MAAM,UAAWA,CAAK,CAChC,CAQFvC,eAAegC,EAAiBS,EAAQC,EAAMpB,GAE5C,IACErB,IACI0C,EAAOhC,MADIA,MAAMC,MAFP,gIAEoCU,UAAeoB,YAAeD,EAAU,CAAEG,KAAM,MAAO,CAAC,GAChFC,KAAK,EAC/BL,QAAQM,IAAIH,CAAI,CAGlB,CAFE,MAAOJ,GACPC,QAAQD,MAAM,UAAWA,CAAK,CAChC,CACF,CACF,EAAG,GAAK"}